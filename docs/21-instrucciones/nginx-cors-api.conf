# =============================================================================
# CORS para API (Laravel detrás de Nginx)
# =============================================================================
# Si el navegador reporta "No 'Access-Control-Allow-Origin' header" aunque
# el servidor devuelva 200, suele ser porque el proxy no reenvía Origin a Laravel
# o Nginx no reenvía las cabeceras de la respuesta. Este snippet añade CORS en
# Nginx (que sí recibe Origin del cliente).
#
# PASO 1 - En el bloque http { } de nginx.conf (o en un include en http):
# -------------------------------------------------------------------------
# map $http_origin $cors_origin {
#     default "";
#     "~^https://[a-z0-9-]+\\.lapesquerapp\\.es$" $http_origin;
#     "https://lapesquerapp.es" $http_origin;
#     "http://localhost:3000" $http_origin;
#     "http://127.0.0.1:3000" $http_origin;
# }
#
# PASO 2 - Dentro del location que hace proxy_pass a Laravel para la API, ej.:
# -------------------------------------------------------------------------
# location /api/ {
#     # Preflight: responder OPTIONS con 204 y CORS (evita pasar a Laravel)
#     if ($request_method = "OPTIONS") {
#         add_header "Access-Control-Allow-Origin" $cors_origin always;
#         add_header "Access-Control-Allow-Methods" "GET, POST, PUT, DELETE, OPTIONS, PATCH" always;
#         add_header "Access-Control-Allow-Headers" "Authorization, Accept, Origin, Content-Type" always;
#         add_header "Access-Control-Allow-Credentials" "true" always;
#         add_header "Access-Control-Max-Age" 86400 always;
#         add_header "Content-Length" 0;
#         return 204;
#     }
#
#     # Añadir CORS a todas las respuestas cuando el origen está permitido
#     if ($cors_origin != "") {
#         add_header "Access-Control-Allow-Origin" $cors_origin always;
#         add_header "Access-Control-Allow-Methods" "GET, POST, PUT, DELETE, OPTIONS, PATCH" always;
#         add_header "Access-Control-Allow-Headers" "Authorization, Accept, Origin, Content-Type" always;
#         add_header "Access-Control-Allow-Credentials" "true" always;
#         add_header "Vary" "Origin" always;
#     }
#
#     proxy_pass http://backend_laravel;
#     proxy_http_version 1.1;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_set_header Origin $http_origin;   # Reenviar Origin a Laravel
# }
#
# IMPORTANTE: "always" hace que las cabeceras se envíen también en 4xx/5xx.
# Reenviar Origin con proxy_set_header Origin $http_origin; para que Laravel
# también pueda añadir CORS si lo desea.
# =============================================================================
